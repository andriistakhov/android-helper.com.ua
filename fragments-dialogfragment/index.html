
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Fragments. DialogFragment - диалог - Android helper</title>
  <meta name="author" content="Andrii Stakhov">

  
  <meta name="description" content="Всем привет. Продолжаю собирать полезную информацию по программированию. Сегодня хотел поделиться с вами работой DialogFragment. Продолжаем &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://android-helper.com.ua//fragments-dialogfragment">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/github/atom.xml" rel="alternate" title="Android helper" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Android helper</a></h1>
  
    <h2>Освоим android вместе?</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/github/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:android-helper.com.ua/" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/"><img src="../../images/home.png" style="width: 28px;"></a></li>
  <li><a href="/blog/archives">Архив</a></li>
    <!--<li><a href="/codes">Коды</a></li>-->
    <li><a href="/">Вебинары</a></li>
    <li><a href="/">Тренинги</a></li>
    <li><a href="/">Услуги</a></li>
    <li><a href="/about">Обо мне</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Fragments. DialogFragment - диалог</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-31T06:25:44+02:00" pubdate data-updated="true">Oct 31<span>st</span>, 2012</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://android-helper.com.ua/">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Всем привет.</p>

<p>Продолжаю собирать полезную информацию по программированию.</p>

<p>Сегодня хотел поделиться с вами работой DialogFragment.</p>

<!-- more -->


<p>Продолжаем рассматривать наследников Fragment. <a href="http://developer.android.com/reference/android/app/DialogFragment.html">DialogFragment</a> – отличается от обычного фрагмента тем, что отображается как диалог и имеет соответствующие методы.</p>

<p>Построить диалог можно двумя способами: используя свой layout-файл и через AlertDialog.Builder. Нарисуем приложение, которое будет вызывать два диалога, построенных разными способами.</p>

<p>Создадим проект:</p>

<p><strong>Project name</strong>: P1101_DialogFragment<br/>
<strong>Build Target</strong>: Android 4.1 <br/>
<strong>Application name</strong>: DialogFragment<br/>
<strong>Package name</strong>: ru.startandroid.develop.p1101dialogfragment<br/>
<strong>Create Activity</strong>: MainActivity</p>

<p>Добавим строки в <strong>strings.xml</strong>:</p>

<pre><code>&lt;string name="dialog_1"&gt;Dialog 1&lt;/string&gt;

&lt;string name="dialog_2"&gt;Dialog 2&lt;/string&gt;

&lt;string name="message_text"&gt;Text of your message&lt;/string&gt;

&lt;string name="yes"&gt;Yes&lt;/string&gt;

&lt;string name="no"&gt;No&lt;/string&gt;

&lt;string name="maybe"&gt;Maybe&lt;/string&gt;
</code></pre>

<p>Мы будем создавать два диалога, соответственно нам понадобятся два фрагмента.</p>

<p>Создадим layout-файл для первого фрагмента.</p>

<p><strong>dialog1.xml</strong>:</p>

<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;

&lt;LinearLayout

xmlns:android="http://schemas.android.com/apk/res/android"

android:layout_width="wrap_content"

android:layout_height="match_parent"

android:orientation="vertical"&gt;

&lt;TextView

android:id="@+id/textView1"

android:layout_width="wrap_content"

android:layout_height="wrap_content"

android:layout_gravity="center"

android:layout_margin="20dp"

android:text="@string/message_text"

android:textAppearance="?android:attr/textAppearanceLarge"&gt;

&lt;/TextView&gt;

&lt;LinearLayout

android:layout_width="wrap_content"

android:layout_height="wrap_content"&gt;

&lt;Button

android:id="@+id/btnYes"

android:layout_width="wrap_content"

android:layout_height="wrap_content"

android:layout_margin="10dp"

android:text="@string/yes"&gt;

&lt;/Button&gt;

&lt;Button

android:id="@+id/btnNo"

android:layout_width="wrap_content"

android:layout_height="wrap_content"

android:layout_margin="10dp"

android:text="@string/no"&gt;

&lt;/Button&gt;

&lt;Button

android:id="@+id/btnMaybe"

android:layout_width="wrap_content"

android:layout_height="wrap_content"

android:layout_margin="10dp"

android:text="@string/maybe"&gt;

&lt;/Button&gt;

&lt;/LinearLayout&gt;

&lt;/LinearLayout&gt;
</code></pre>

<p>Так будет выглядеть наш диалог – текст сообщения и три кнопки.</p>

<p>Создаем класс <strong>Dialog1.java</strong>:</p>

<pre><code>package com.example.dialogfragments;



import android.content.DialogInterface;

import android.os.Bundle;

import android.support.v4.app.DialogFragment;

import android.util.Log;

import android.view.LayoutInflater;

import android.view.View;

import android.view.View.OnClickListener;

import android.view.ViewGroup;

import android.widget.Button;



public class Dialog1 extends DialogFragment implements OnClickListener {



    final String LOG_TAG = "myLogs";



    @Override

    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {

    getDialog().setTitle("Title!");

    View v = inflater.inflate(R.layout.dialog1, null);

    v.findViewById(R.id.btnYes).setOnClickListener(this);

    v.findViewById(R.id.btnNo).setOnClickListener(this);

    v.findViewById(R.id.btnMaybe).setOnClickListener(this);

    return v;

    }



    public void onClick(View v) {

    Log.d(LOG_TAG, "Dialog 1: " + ((Button) v).getText());

    dismiss();

    }



    @Override

    public void onDismiss(DialogInterface dialog) {

    super.onDismiss(dialog);

    Log.d(LOG_TAG, "Dialog 1: onDismiss");

    }



    @Override

    public void onCancel(DialogInterface dialog) {

    super.onCancel(dialog);

    Log.d(LOG_TAG, "Dialog 1: onCancel");

    }

}
</code></pre>

<p>В <strong>onCreateView</strong> мы получаем объект Dialog с помощью метода <a href="http://developer.android.com/reference/android/app/DialogFragment.html#getDialog(">getDialog</a>) и устанавливаем заголовок диалога. Далее мы создаем view из layout, находим в нем кнопки и ставим им текущий фрагмент в качестве обработчика.</p>

<p>В <strong>onClick</strong> выводим в лог текст нажатой кнопки и сами явно закрываем диалог методом <a href="http://developer.android.com/reference/android/app/DialogFragment.html#dismiss(">dismiss</a>).</p>

<p>Метод <a href="http://developer.android.com/reference/android/app/DialogFragment.html#onDismiss(android.content.DialogInterface">onDismiss</a>) срабатывает, когда диалог закрывается. Пишем об этом в лог.</p>

<p>Метод <a href="http://developer.android.com/reference/android/app/DialogFragment.html#onCancel(android.content.DialogInterface">onCancel</a>) срабатывает, когда диалог отменяют кнопкой Назад. Пишем об этом в лог.</p>

<p>Создаем второй фрагмент. Здесь мы будем строить диалог с помощью билдера, поэтому layout-файл не понадобится. Создаем только класс <strong>Dialog2.java</strong>:</p>

<pre><code>package com.example.dialogfragments;



import android.app.AlertDialog;

import android.app.Dialog;

import android.content.DialogInterface;

import android.content.DialogInterface.OnClickListener;

import android.os.Bundle;

import android.support.v4.app.DialogFragment;

import android.util.Log;



public class Dialog2 extends DialogFragment implements OnClickListener {



final String LOG_TAG = "myLogs";



@Override

public Dialog onCreateDialog(Bundle savedInstanceState) {

    AlertDialog.Builder adb = new AlertDialog.Builder(getActivity()).setTitle("Title!")

            .setPositiveButton(R.string.yes, this).setNegativeButton(R.string.no, this)

            .setNeutralButton(R.string.maybe, this).setMessage(R.string.message_text);

    return adb.create();

}



public void onClick(DialogInterface dialog, int which) {

    int i = 0;

    switch (which) {

        case Dialog.BUTTON_POSITIVE:

            i = R.string.yes;

            break;

        case Dialog.BUTTON_NEGATIVE:

            i = R.string.no;

            break;

        case Dialog.BUTTON_NEUTRAL:

            i = R.string.maybe;

            break;

    }

    if (i &gt; 0) {

        Log.d(LOG_TAG, "Dialog 2: " + getResources().getString(i));

    }

}



@Override

public void onDismiss(DialogInterface dialog) {

    super.onDismiss(dialog);

    Log.d(LOG_TAG, "Dialog 2: onDismiss");

}



@Override

public void onCancel(DialogInterface dialog) {

    super.onCancel(dialog);

    Log.d(LOG_TAG, "Dialog 2: onCancel");

}

}
</code></pre>

<p>Обычно для заполнения фрагмента содержимым мы использовали метод onCreateView. Для создания диалога с помощью билдера используется <a href="http://developer.android.com/reference/android/app/DialogFragment.html#onCreateDialog(android.os.Bundle">onCreateDialog</a>). Создаем диалог с заголовком, сообщением и тремя кнопками. Обработчиком для кнопок назначаем текущий фрагмент.</p>

<p>В <strong>onClick</strong> определяем, какая кнопка была нажата и выводим соответствующий текст в лог. В случае создания диалога через билдер, диалог сам закроется по нажатию на кнопку, метод dismiss здесь не нужен.</p>

<p>Методы <strong>onDismiss</strong> и <strong>onCancel</strong> – это закрытие и отмена диалога, аналогично первому фрагменту.</p>

<p>Меняем layout-файл для MainActivity - <strong>main.xml</strong>:</p>

<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;

&lt;LinearLayout

xmlns:android="http://schemas.android.com/apk/res/android"

xmlns:tools="http://schemas.android.com/tools"

 android:id="@+id/LinearLayout1"

 android:layout_width="match_parent"

 android:layout_height="match_parent"

 android:orientation="vertical"&gt;

&lt;Button

 android:id="@+id/btnDlg1"

 android:layout_width="wrap_content"

 android:layout_height="wrap_content"

 android:onClick="onClick"

 android:text="@string/dialog_1"&gt;

&lt;/Button&gt;

&lt;Button

 android:id="@+id/btnDlg2"

 android:layout_width="wrap_content"

 android:layout_height="wrap_content"

 android:onClick="onClick"

 android:text="@string/dialog_2"&gt;

&lt;/Button&gt;

&lt;/LinearLayout&gt;
</code></pre>

<p>Здесь только две кнопки.</p>

<p>Кодим <strong>MainActivity.java</strong>:</p>

<pre><code>package com.example.dialogfragments;



import android.os.Bundle;

import android.support.v4.app.DialogFragment;

import android.support.v4.app.FragmentActivity;

import android.view.View;



public class MainActivity extends FragmentActivity {



DialogFragment dlg1;

DialogFragment dlg2;



@Override

public void onCreate(Bundle savedInstanceState) {

    super.onCreate(savedInstanceState);

    setContentView(R.layout.activity_main);

    dlg1 = new Dialog1();

    dlg2 = new Dialog2();

}



public void onClick(View v) {

    switch (v.getId()) {

        case R.id.btnDlg1:

            dlg1.show(getSupportFragmentManager(), "dlg1");

            break;

        case R.id.btnDlg2:

            dlg2.show(getSupportFragmentManager(), "dlg2");

            break;

        default:

            break;

    }



}

}
</code></pre>

<p>Создаем диалоги и запускаем их методом <a href="http://developer.android.com/reference/android/app/DialogFragment.html#show(android.app.FragmentManager,%20java.lang.String">show</a>), который на вход требует FragmentManager и строку-тэг. Транзакция и коммит происходят внутри этого метода, нам об этом думать не надо.</p>

<p>Все сохраняем и запускаем приложение.</p>

<p><img src="http://startandroid.ru/images/stories/lessons/L0110/L0110_010.JPG" alt="" /></p>

<p>Жмем <strong>Dialog1</strong></p>

<p><img src="http://startandroid.ru/images/stories/lessons/L0110/L0110_020.JPG" alt="" /></p>

<p>Отобразился наш простенький диалог.</p>

<p>Жмем какую-нибудь кнопку, например, <strong>Yes </strong>&ndash; диалог закрылся. Смотрим логи:</p>

<p><em>Dialog 1: Yes<br/>
Dialog 1: onDismiss</em></p>

<p>Все верно.</p>

<p>Снова запустим первый диалог и нажмем клавишу <strong>Назад </strong>(<strong>Back</strong>). Смотрим лог:</p>

<p><em>Dialog<strong> 1: </strong>onCancel__<br/>
Dialog 1: onDismiss</em></p>

<p>Сработал onCancel – диалог был отменен, и onDismiss – диалог закрылся.</p>

<p>Если мы будем поворачивать экран, то каждый раз будет отрабатывать onDismiss, но диалог снова будет отображен после поворота.</p>

<p>Запустим второй диалог – нажмем кнопку <strong>Dialog 2</strong>.</p>

<p><img src="http://startandroid.ru/images/stories/lessons/L0110/L0110_030.JPG" alt="" /></p>

<p>Отобразился стандартный сконструированный нами диалог. Жмем, например, <strong>No </strong>– диалог закрылся. В логах:</p>

<p><em>Dialog 2: No<br/>
Dialog 2: onDismiss</em></p>

<p>Снова запустим второй диалог и нажмем <strong>Назад</strong>. В логах:</p>

<p><em>Dialog<strong> 2: </strong>onCancel__<br/>
Dialog 2: onDismiss</em></p>

<p>Все так же, как и в первом случае.</p>

<p>Еще несколько слов по теме.</p>

<p>Если вы не хотите, чтобы ваш диалог можно было закрыть кнопкой, используйте для вашего диалог-фрагмента метод <a href="http://developer.android.com/reference/android/app/DialogFragment.html#setCancelable(boolean">setCancelable</a>) с параметром false.</p>

<p>Есть еще один вариант вызова диалога. Это метод <a href="http://developer.android.com/reference/android/app/DialogFragment.html#show(android.app.FragmentTransaction,%20java.lang.String">show</a>), но на вход он уже принимает не FragmentManager, а FragmentTransaction. В этом случае система также сама вызовет commit внутри show, но мы можем предварительно поместить в созданную нами транзакцию какие-либо еще операции или отправить ее в BackStack.</p>

<p>Вы можете использовать диалог-фрагменты, как обычные фрагменты и отображать их на Activity, а не в виде диалога. Но при этом будьте аккуратнее с использованием <strong>getDialog</strong>. Я так понял, что он возвращает null в этом случае.</p>

<p>Если <strong>AlertDialog.Builder</strong> вам незнаком, то посмотрите Урок 60 и несколько следующих за ним. Там достаточно подробно описано, как создавать различные диалоги.</p>

<p>Статья из сайта <a href="http://startandroid.ru/uroki/vse-uroki-spiskom/180-urok-110-android-3-fragments-dialogfragment-dialog.html">startandroid.ru</a></p>

<p>Полный проект вы можете скачать на <a href="http://android-helper.com.ua/codes/">странице с кодами</a>.</p>

<p>Пишите ваши комментарии.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">andrew</span></span>

      








  


<time datetime="2012-10-31T06:25:44+02:00" pubdate data-updated="true">Oct 31<span>st</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/categories/android-dlia-nachinaiushchikh/'>Android для начинающих</a>, <a class='category' href='/categories/android-dlia-profiessionalov/'>Android для профессионалов</a>, <a class='category' href='/categories/proghrammirovaniie/'>Программирование</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://android-helper.com.ua//fragments-dialogfragment/" data-via="helperandroid" data-counturl="http://android-helper.com.ua//fragments-dialogfragment/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/mind-games/" title="Previous Post: Игры Разума">&laquo; Игры Разума</a>
      
      
        <a class="basic-alignment right" href="/conception/" title="Next Post: Развитие блога">Развитие блога &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/happy_new_year/">C Новым годом!</a>
      </li>
    
      <li class="post">
        <a href="/skype-premium/">Skype - годовой преимум аккаунт бесплатно!</a>
      </li>
    
      <li class="post">
        <a href="/custom-font/">Custom Font - свои шрифты в Android</a>
      </li>
    
      <li class="post">
        <a href="/ganymotion-root/">Genymotion Root - Как получить права рут на емуляторе</a>
      </li>
    
      <li class="post">
        <a href="/coaching_report/">Отчет по коучингу</a>
      </li>
    
  </ul>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/Android-helperUa?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>


<ul>
    
    <li><a href="#Что такое android">Что такое android</a></li>
    
    <li><a href="#Новости сайта">Новости сайта</a></li>
    
    <li><a href="#Программы для android">Программы для android</a></li>
    
    <li><a href="#Android для начинающих">Android для начинающих</a></li>
    
    <li><a href="#Памятка разработчику">Памятка разработчику</a></li>
    
    <li><a href="#Программирование">Программирование</a></li>
    
    <li><a href="#Android для профессионалов">Android для профессионалов</a></li>
    
    <li><a href="#Тренинги">Тренинги</a></li>
    
    <li><a href="#Игры для android">Игры для android</a></li>
    
    <li><a href="#Интервью">Интервью</a></li>
    
    <li><a href="#Коучинг">Коучинг</a></li>
    
</ul>
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Andrii Stakhov -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'androidhelper';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://android-helper.com.ua//fragments-dialogfragment/';
        var disqus_url = 'http://android-helper.com.ua//fragments-dialogfragment/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
